/*lock pseudocode
step_and_notify();
wait();
if(try_lock(..))
{
return;
}

step_and_notify();
wait();
if(try_lock(..))
{
  return;
 }
assert(false);
}
*/
